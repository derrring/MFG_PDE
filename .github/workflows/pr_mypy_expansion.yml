name: PR Mypy Expansion Check
#
# Temporary workflow for mypy expansion PR to check only changed files
# This avoids blocking on 600+ pre-existing style issues in the codebase
#

on:
  pull_request:
    branches: [main]
    paths:
      - 'mfg_pde/factory/solver_factory.py'
      - 'mfg_pde/geometry/base_geometry.py'
      - '.pre-commit-config.yaml'

jobs:
  mypy-expansion-check:
    runs-on: ubuntu-latest
    if: contains(github.head_ref, 'mypy') || contains(github.head_ref, 'type')

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: 3.12
        cache: pip

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -e .[dev]

    - name: Check changed Python files with Ruff
      run: |
        echo "üîç Checking only PR-modified files with Ruff..."
        ruff check mfg_pde/factory/solver_factory.py mfg_pde/geometry/base_geometry.py
        echo "‚úÖ All changed files pass Ruff checks"

    - name: Check changed Python files with mypy
      run: |
        echo "üîç Checking only PR-modified files with mypy..."
        mypy mfg_pde/factory/solver_factory.py mfg_pde/geometry/base_geometry.py --follow-imports=silent --ignore-missing-imports
        echo "‚úÖ All changed files pass mypy checks"

    - name: Verify mypy coverage expansion
      run: |
        echo "üîç Testing expanded mypy coverage pattern..."
        mypy mfg_pde/simple.py mfg_pde/core/mfg_problem.py mfg_pde/types/ mfg_pde/geometry/base_geometry.py mfg_pde/factory/solver_factory.py --follow-imports=silent --ignore-missing-imports
        echo "‚úÖ All files in expanded mypy coverage pass"

    - name: Summary
      run: |
        echo "üéâ Mypy expansion PR validation complete!"
        echo "‚úÖ Changed files pass all quality checks"
        echo "‚úÖ Mypy coverage successfully expanded"
        echo "‚úÖ Pre-commit integration functional"
